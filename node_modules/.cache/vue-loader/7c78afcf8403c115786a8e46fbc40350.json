{"remainingRequest":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\my-components\\xboot\\file-upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\my-components\\xboot\\file-upload.vue","mtime":1600218271000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHVwbG9hZEZpbGUgfSBmcm9tICJAL2FwaS9pbmRleCI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiZmlsZVVwbG9hZCIsCiAgcHJvcHM6IHsKICAgIHZhbHVlOiBPYmplY3QsCiAgICBzaXplOiBTdHJpbmcsCiAgICB0eXBlOiBTdHJpbmcsCiAgICBnaG9zdDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGRpc2FibGVkOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgc2hhcGU6IFN0cmluZywKICAgIGljb246IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiaW9zLWNsb3VkLXVwbG9hZC1vdXRsaW5lIgogICAgfSwKICAgIHRleHQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAi5LiK5Lyg5paH5Lu2IgogICAgfSwKICAgIG1heFNpemU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA1CiAgICB9LAogICAgYWNjZXB0OiBTdHJpbmcKICB9LAogIGNvbXB1dGVkOiB7CiAgICBmb3JtYXQoKSB7CiAgICAgIGlmICh0aGlzLmFjY2VwdCkgewogICAgICAgIGxldCBmb3JtYXQgPSBbXTsKICAgICAgICB0aGlzLmFjY2VwdC5zcGxpdCgiLCIpLmZvckVhY2goZSA9PiB7CiAgICAgICAgICBmb3JtYXQucHVzaChlLnJlcGxhY2UoIi4iLCAiIikucmVwbGFjZSgiICIsICIiKSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGZvcm1hdDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBhY2Nlc3NUb2tlbjoge30sCiAgICAgIHRpdGxlOiAi54K55Ye75LiL6L29IiwKICAgICAgY3VycmVudFZhbHVlOiB0aGlzLnZhbHVlLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgdXBsb2FkRmlsZVVybDogdXBsb2FkRmlsZQogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXQoKSB7CiAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSB7CiAgICAgICAgYWNjZXNzVG9rZW46IHRoaXMuZ2V0U3RvcmUoImFjY2Vzc1Rva2VuIikKICAgICAgfTsKICAgIH0sCiAgICBkb3dubG9hZCgpIHsKICAgICAgaWYgKCF0aGlzLmN1cnJlbnRWYWx1ZS51cmwpIHsKICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCLml6DmlYjnmoTpk77mjqUiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgd2luZG93Lm9wZW4oCiAgICAgICAgdGhpcy5jdXJyZW50VmFsdWUudXJsICsKICAgICAgICAgICI/YXR0bmFtZT0mcmVzcG9uc2UtY29udGVudC10eXBlPWFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSZmaWxlbmFtZT0iICsKICAgICAgICAgIHRoaXMuY3VycmVudFZhbHVlLm5hbWUKICAgICAgKTsKICAgIH0sCiAgICBoYW5kbGVGb3JtYXRFcnJvcihmaWxlKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgdGl0bGU6ICLkuI3mlK/mjIHnmoTmlofku7bmoLzlvI8iLAogICAgICAgIGRlc2M6CiAgICAgICAgICAi5omA6YCJ5paH5Lu24oCYICIgKwogICAgICAgICAgZmlsZS5uYW1lICsKICAgICAgICAgICIg4oCZ5qC85byP5LiN5q2j56GuLCDor7fpgInmi6kgIiArCiAgICAgICAgICB0aGlzLmFjY2VwdCArCiAgICAgICAgICAiIOagvOW8j+aWh+S7tiIKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlTWF4U2l6ZShmaWxlKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB0aGlzLiROb3RpY2Uud2FybmluZyh7CiAgICAgICAgdGl0bGU6ICLmlofku7blpKflsI/ov4flpKciLAogICAgICAgIGRlc2M6CiAgICAgICAgICAi5omA6YCJ5paH5Lu24oCYICIgKwogICAgICAgICAgZmlsZS5uYW1lICsKICAgICAgICAgICIg4oCZ5aSn5bCP6L+H5aSnLCDkuI3lvpfotoXov4cgIiArCiAgICAgICAgICB0aGlzLm1heFNpemUgKwogICAgICAgICAgIk0uIgogICAgICB9KTsKICAgIH0sCiAgICBiZWZvcmVVcGxvYWQoKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIGhhbmRsZVN1Y2Nlc3MocmVzLCBmaWxlKSB7CiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IHsKICAgICAgICAgIHVybDogcmVzLnJlc3VsdCwKICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZQogICAgICAgIH07CiAgICAgICAgdGhpcy50aXRsZSA9CiAgICAgICAgICAi54K55Ye75LiL6L29KCIgKwogICAgICAgICAgKChmaWxlLnNpemUgKiAxLjApIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgyKSArCiAgICAgICAgICAiIE1CKSI7CiAgICAgICAgdGhpcy4kZW1pdCgiaW5wdXQiLCB0aGlzLmN1cnJlbnRWYWx1ZSk7CiAgICAgICAgdGhpcy4kZW1pdCgib24tY2hhbmdlIiwgdGhpcy5jdXJyZW50VmFsdWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IocmVzLm1lc3NhZ2UpOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlRXJyb3IoZXJyb3IsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKGVycm9yLnRvU3RyaW5nKCkpOwogICAgfSwKICAgIGhhbmRsZUNoYW5nZSh2KSB7CiAgICAgIHRoaXMuJGVtaXQoImlucHV0IiwgdGhpcy5jdXJyZW50VmFsdWUpOwogICAgICB0aGlzLiRlbWl0KCJvbi1jaGFuZ2UiLCB0aGlzLmN1cnJlbnRWYWx1ZSk7CiAgICB9LAogICAgc2V0Q3VycmVudFZhbHVlKHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gdGhpcy5jdXJyZW50VmFsdWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5jdXJyZW50VmFsdWUgPSB2YWx1ZTsKICAgICAgaWYgKHRoaXMuY3VycmVudFZhbHVlLnNpemUpIHsKICAgICAgICB0aGlzLnRpdGxlID0KICAgICAgICAgICLngrnlh7vkuIvovb0oIiArCiAgICAgICAgICAoKHRoaXMuY3VycmVudFZhbHVlLnNpemUgKiAxLjApIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgyKSArCiAgICAgICAgICAiIE1CKSI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50aXRsZSA9ICLngrnlh7vkuIvovb0iOwogICAgICB9CiAgICAgIHRoaXMuJGVtaXQoIm9uLWNoYW5nZSIsIHRoaXMuY3VycmVudFZhbHVlKTsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICB2YWx1ZSh2YWwpIHsKICAgICAgdGhpcy5zZXRDdXJyZW50VmFsdWUodmFsKTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICB9Cn07Cg=="},{"version":3,"sources":["file-upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"file-upload.vue","sourceRoot":"src/views/my-components/xboot","sourcesContent":["<template>\n  <div>\n    <div class=\"file-upload-wrap\">\n      <Upload\n        :action=\"uploadFileUrl\"\n        :headers=\"accessToken\"\n        :on-success=\"handleSuccess\"\n        :on-error=\"handleError\"\n        :format=\"format\"\n        :accept=\"accept\"\n        :max-size=\"maxSize*1024\"\n        :on-format-error=\"handleFormatError\"\n        :on-exceeded-size=\"handleMaxSize\"\n        :before-upload=\"beforeUpload\"\n        :show-upload-list=\"false\"\n        class=\"file-upload\"\n      >\n        <Button\n          :loading=\"loading\"\n          :type=\"type\"\n          :ghost=\"ghost\"\n          :shape=\"shape\"\n          :size=\"size\"\n          :disabled=\"disabled\"\n          :icon=\"icon\"\n        >{{text}}</Button>\n      </Upload>\n      <Tooltip transfer :content=\"title\" placement=\"top\">\n        <a @click=\"download\">{{currentValue.name}}</a>\n      </Tooltip>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { uploadFile } from \"@/api/index\";\nexport default {\n  name: \"fileUpload\",\n  props: {\n    value: Object,\n    size: String,\n    type: String,\n    ghost: {\n      type: Boolean,\n      default: false\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    shape: String,\n    icon: {\n      type: String,\n      default: \"ios-cloud-upload-outline\"\n    },\n    text: {\n      type: String,\n      default: \"上传文件\"\n    },\n    maxSize: {\n      type: Number,\n      default: 5\n    },\n    accept: String\n  },\n  computed: {\n    format() {\n      if (this.accept) {\n        let format = [];\n        this.accept.split(\",\").forEach(e => {\n          format.push(e.replace(\".\", \"\").replace(\" \", \"\"));\n        });\n        return format;\n      } else {\n        return [];\n      }\n    }\n  },\n  data() {\n    return {\n      accessToken: {},\n      title: \"点击下载\",\n      currentValue: this.value,\n      loading: false,\n      uploadFileUrl: uploadFile\n    };\n  },\n  methods: {\n    init() {\n      this.accessToken = {\n        accessToken: this.getStore(\"accessToken\")\n      };\n    },\n    download() {\n      if (!this.currentValue.url) {\n        this.$Message.error(\"无效的链接\");\n        return;\n      }\n      window.open(\n        this.currentValue.url +\n          \"?attname=&response-content-type=application/octet-stream&filename=\" +\n          this.currentValue.name\n      );\n    },\n    handleFormatError(file) {\n      this.loading = false;\n      this.$Notice.warning({\n        title: \"不支持的文件格式\",\n        desc:\n          \"所选文件‘ \" +\n          file.name +\n          \" ’格式不正确, 请选择 \" +\n          this.accept +\n          \" 格式文件\"\n      });\n    },\n    handleMaxSize(file) {\n      this.loading = false;\n      this.$Notice.warning({\n        title: \"文件大小过大\",\n        desc:\n          \"所选文件‘ \" +\n          file.name +\n          \" ’大小过大, 不得超过 \" +\n          this.maxSize +\n          \"M.\"\n      });\n    },\n    beforeUpload() {\n      this.loading = true;\n      return true;\n    },\n    handleSuccess(res, file) {\n      this.loading = false;\n      if (res.success) {\n        this.currentValue = {\n          url: res.result,\n          name: file.name,\n          size: file.size\n        };\n        this.title =\n          \"点击下载(\" +\n          ((file.size * 1.0) / (1024 * 1024)).toFixed(2) +\n          \" MB)\";\n        this.$emit(\"input\", this.currentValue);\n        this.$emit(\"on-change\", this.currentValue);\n      } else {\n        this.$Message.error(res.message);\n      }\n    },\n    handleError(error, file, fileList) {\n      this.loading = false;\n      this.$Message.error(error.toString());\n    },\n    handleChange(v) {\n      this.$emit(\"input\", this.currentValue);\n      this.$emit(\"on-change\", this.currentValue);\n    },\n    setCurrentValue(value) {\n      if (value === this.currentValue) {\n        return;\n      }\n      this.currentValue = value;\n      if (this.currentValue.size) {\n        this.title =\n          \"点击下载(\" +\n          ((this.currentValue.size * 1.0) / (1024 * 1024)).toFixed(2) +\n          \" MB)\";\n      } else {\n        this.title = \"点击下载\";\n      }\n      this.$emit(\"on-change\", this.currentValue);\n    }\n  },\n  watch: {\n    value(val) {\n      this.setCurrentValue(val);\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.file-upload-wrap {\n  display: flex;\n  align-items: center;\n  .file-upload {\n    display: inline-block;\n    margin-right: 10px;\n  }\n}\n</style>\n\n"]}]}