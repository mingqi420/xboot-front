{"remainingRequest":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\authorize.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\authorize.vue","mtime":1600218271000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAiLi9hdXRob3JpemUubGVzcyI7Cg=="},{"version":3,"sources":["authorize.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmPA","file":"authorize.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"authorize\">\n    <Row\n      type=\"flex\"\n      justify=\"center\"\n      align=\"middle\"\n      @keydown.enter.native=\"submit\"\n      style=\"height:100%\"\n    >\n      <Col class=\"layout\">\n        <div>\n          <Header />\n          <Row v-if=\"!error&&!authLoading\">\n            <Tabs value=\"1\">\n              <TabPane label=\"XBoot统一认证平台\" name=\"1\" icon=\"md-people\">\n                <Form ref=\"loginForm\" :model=\"form\" :rules=\"rules\" class=\"form\">\n                  <FormItem prop=\"username\">\n                    <Input\n                      v-model=\"form.username\"\n                      prefix=\"ios-contact\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入用户名\"\n                      autocomplete=\"off\"\n                    />\n                  </FormItem>\n                  <FormItem prop=\"password\">\n                    <Input\n                      type=\"password\"\n                      v-model=\"form.password\"\n                      prefix=\"ios-lock\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入密码\"\n                      autocomplete=\"off\"\n                    />\n                  </FormItem>\n                  <FormItem prop=\"code\">\n                    <Row\n                      type=\"flex\"\n                      justify=\"space-between\"\n                      style=\"align-items: center;overflow: hidden;\"\n                    >\n                      <Input\n                        v-model=\"form.code\"\n                        size=\"large\"\n                        clearable\n                        placeholder=\"请输入图片验证码\"\n                        :maxlength=\"10\"\n                        style=\"width: 67%;\"\n                      />\n                      <div class=\"code-image\" style=\"position:relative;font-size:12px\">\n                        <Spin v-if=\"loadingCaptcha\" fix></Spin>\n                        <img\n                          :src=\"captchaImg\"\n                          @click=\"getCaptchaImg\"\n                          alt=\"加载验证码失败\"\n                          style=\"width:110px;cursor:pointer;display:block\"\n                        />\n                      </div>\n                    </Row>\n                  </FormItem>\n                </Form>\n              </TabPane>\n            </Tabs>\n            <Row>\n              <Button type=\"primary\" size=\"large\" :loading=\"loading\" @click=\"submit\" long>\n                <span v-if=\"!loading\">授权并登录</span>\n                <span v-else>授权中...</span>\n              </Button>\n            </Row>\n            <Row type=\"flex\" justify=\"space-between\" class=\"other-thing\">\n              <router-link to=\"/reset\" class=\"back\">忘记密码</router-link>\n              <router-link to=\"/regist\">\n                <a class=\"back\">还没有账号？立即注册</a>\n              </router-link>\n            </Row>\n          </Row>\n          <div v-if=\"error\" style=\"margin-top: 15vh\">\n            <Alert type=\"error\" show-icon>\n              {{title}}\n              <span slot=\"desc\">{{msg}}</span>\n            </Alert>\n          </div>\n          <div v-if=\"authLoading\">\n            <RectLoading />\n          </div>\n        </div>\n        <Footer />\n      </Col>\n      <LangSwitch />\n    </Row>\n  </div>\n</template>\n\n<script>\nimport Cookies from \"js-cookie\";\nimport { initCaptcha, drawCodeImage } from \"@/api/index\";\nimport { authorize, authorized } from \"@/api/open\";\nimport Header from \"@/views/main-components/header\";\nimport Footer from \"@/views/main-components/footer\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport RectLoading from \"@/views/my-components/xboot/rect-loading\";\nexport default {\n  components: {\n    LangSwitch,\n    Header,\n    Footer,\n    RectLoading\n  },\n  data() {\n    return {\n      authLoading: false,\n      title: \"\",\n      msg: \"\",\n      error: false,\n      loadingCaptcha: true,\n      captchaImg: \"\",\n      loading: false,\n      form: {\n        username: \"\",\n        password: \"\",\n        code: \"\",\n        client_id: \"\",\n        redirect_uri: \"\",\n        state: \"\",\n        response_type: \"\",\n        captchaId: this.captchaId\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        code: [\n          {\n            required: true,\n            message: \"验证码不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    judgeUrl() {\n      let q = this.$route.query;\n      if (!q.client_id) {\n        this.title = \"参数client_id非法\";\n        this.msg = \"The parameter client_id is illegal.\";\n        this.error = true;\n        return;\n      }\n      if (!q.redirect_uri) {\n        this.title = \"参数redirect_uri非法\";\n        this.msg = \"The parameter redirect_uri is illegal.\";\n        this.error = true;\n        return;\n      }\n      if (!q.state) {\n        this.title = \"参数state非法\";\n        this.msg = \"The parameter state is illegal.\";\n        this.error = true;\n        return;\n      }\n      this.form.client_id = q.client_id;\n      this.form.redirect_uri = q.redirect_uri;\n      this.form.state = q.state;\n      this.form.responseType = q.responseType;\n    },\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.form.captchaId = res.result;\n          this.captchaImg = drawCodeImage + res.result;\n        }\n      });\n    },\n    submit() {\n      this.$refs.loginForm.validate(valid => {\n        if (valid) {\n          this.loading = true;\n          authorize(this.form).then(res => {\n            if (res.success) {\n              // 存储认证信息 避免下次认证\n              Cookies.set(\"oauthUsername\", this.form.username, {\n                expires: 30\n              });\n              let url =\n                res.result.redirect_uri +\n                \"?code=\" +\n                res.result.code +\n                \"&state=\" +\n                res.result.state;\n              window.location.href = url;\n            } else {\n              this.loading = false;\n              this.getCaptchaImg();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    this.judgeUrl();\n    // 判断是否认证过\n    let username = Cookies.get(\"oauthUsername\");\n    if (username) {\n      this.authLoading = true;\n      this.form.username = username;\n      authorized(this.form).then(res => {\n        if (res.success) {\n          let url =\n            res.result.redirect_uri +\n            \"?code=\" +\n            res.result.code +\n            \"&state=\" +\n            res.result.state;\n          window.location.href = url;\n        } else {\n          this.authLoading = false;\n        }\n      });\n    }\n    this.getCaptchaImg();\n  }\n};\n</script>\n\n<style lang=\"less\">\n@import \"./authorize.less\";\n</style>\n"]}]}