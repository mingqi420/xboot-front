{"remainingRequest":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\authorize.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\authorize.vue","mtime":1600218271000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBDb29raWVzIGZyb20gImpzLWNvb2tpZSI7CmltcG9ydCB7IGluaXRDYXB0Y2hhLCBkcmF3Q29kZUltYWdlIH0gZnJvbSAiQC9hcGkvaW5kZXgiOwppbXBvcnQgeyBhdXRob3JpemUsIGF1dGhvcml6ZWQgfSBmcm9tICJAL2FwaS9vcGVuIjsKaW1wb3J0IEhlYWRlciBmcm9tICJAL3ZpZXdzL21haW4tY29tcG9uZW50cy9oZWFkZXIiOwppbXBvcnQgRm9vdGVyIGZyb20gIkAvdmlld3MvbWFpbi1jb21wb25lbnRzL2Zvb3RlciI7CmltcG9ydCBMYW5nU3dpdGNoIGZyb20gIkAvdmlld3MvbWFpbi1jb21wb25lbnRzL2xhbmctc3dpdGNoIjsKaW1wb3J0IFJlY3RMb2FkaW5nIGZyb20gIkAvdmlld3MvbXktY29tcG9uZW50cy94Ym9vdC9yZWN0LWxvYWRpbmciOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTGFuZ1N3aXRjaCwKICAgIEhlYWRlciwKICAgIEZvb3RlciwKICAgIFJlY3RMb2FkaW5nCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgYXV0aExvYWRpbmc6IGZhbHNlLAogICAgICB0aXRsZTogIiIsCiAgICAgIG1zZzogIiIsCiAgICAgIGVycm9yOiBmYWxzZSwKICAgICAgbG9hZGluZ0NhcHRjaGE6IHRydWUsCiAgICAgIGNhcHRjaGFJbWc6ICIiLAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgZm9ybTogewogICAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgY29kZTogIiIsCiAgICAgICAgY2xpZW50X2lkOiAiIiwKICAgICAgICByZWRpcmVjdF91cmk6ICIiLAogICAgICAgIHN0YXRlOiAiIiwKICAgICAgICByZXNwb25zZV90eXBlOiAiIiwKICAgICAgICBjYXB0Y2hhSWQ6IHRoaXMuY2FwdGNoYUlkCiAgICAgIH0sCiAgICAgIHJ1bGVzOiB7CiAgICAgICAgdXNlcm5hbWU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6ICLotKblj7fkuI3og73kuLrnqboiLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIHBhc3N3b3JkOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAi5a+G56CB5LiN6IO95Li656m6IiwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBjb2RlOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAi6aqM6K+B56CB5LiN6IO95Li656m6IiwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAganVkZ2VVcmwoKSB7CiAgICAgIGxldCBxID0gdGhpcy4kcm91dGUucXVlcnk7CiAgICAgIGlmICghcS5jbGllbnRfaWQpIHsKICAgICAgICB0aGlzLnRpdGxlID0gIuWPguaVsGNsaWVudF9pZOmdnuazlSI7CiAgICAgICAgdGhpcy5tc2cgPSAiVGhlIHBhcmFtZXRlciBjbGllbnRfaWQgaXMgaWxsZWdhbC4iOwogICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIXEucmVkaXJlY3RfdXJpKSB7CiAgICAgICAgdGhpcy50aXRsZSA9ICLlj4LmlbByZWRpcmVjdF91cmnpnZ7ms5UiOwogICAgICAgIHRoaXMubXNnID0gIlRoZSBwYXJhbWV0ZXIgcmVkaXJlY3RfdXJpIGlzIGlsbGVnYWwuIjsKICAgICAgICB0aGlzLmVycm9yID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCFxLnN0YXRlKSB7CiAgICAgICAgdGhpcy50aXRsZSA9ICLlj4LmlbBzdGF0ZemdnuazlSI7CiAgICAgICAgdGhpcy5tc2cgPSAiVGhlIHBhcmFtZXRlciBzdGF0ZSBpcyBpbGxlZ2FsLiI7CiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuZm9ybS5jbGllbnRfaWQgPSBxLmNsaWVudF9pZDsKICAgICAgdGhpcy5mb3JtLnJlZGlyZWN0X3VyaSA9IHEucmVkaXJlY3RfdXJpOwogICAgICB0aGlzLmZvcm0uc3RhdGUgPSBxLnN0YXRlOwogICAgICB0aGlzLmZvcm0ucmVzcG9uc2VUeXBlID0gcS5yZXNwb25zZVR5cGU7CiAgICB9LAogICAgZ2V0Q2FwdGNoYUltZygpIHsKICAgICAgdGhpcy5sb2FkaW5nQ2FwdGNoYSA9IHRydWU7CiAgICAgIGluaXRDYXB0Y2hhKCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMubG9hZGluZ0NhcHRjaGEgPSBmYWxzZTsKICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgIHRoaXMuZm9ybS5jYXB0Y2hhSWQgPSByZXMucmVzdWx0OwogICAgICAgICAgdGhpcy5jYXB0Y2hhSW1nID0gZHJhd0NvZGVJbWFnZSArIHJlcy5yZXN1bHQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzdWJtaXQoKSB7CiAgICAgIHRoaXMuJHJlZnMubG9naW5Gb3JtLnZhbGlkYXRlKHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CiAgICAgICAgICBhdXRob3JpemUodGhpcy5mb3JtKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgIC8vIOWtmOWCqOiupOivgeS/oeaBryDpgb/lhY3kuIvmrKHorqTor4EKICAgICAgICAgICAgICBDb29raWVzLnNldCgib2F1dGhVc2VybmFtZSIsIHRoaXMuZm9ybS51c2VybmFtZSwgewogICAgICAgICAgICAgICAgZXhwaXJlczogMzAKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBsZXQgdXJsID0KICAgICAgICAgICAgICAgIHJlcy5yZXN1bHQucmVkaXJlY3RfdXJpICsKICAgICAgICAgICAgICAgICI/Y29kZT0iICsKICAgICAgICAgICAgICAgIHJlcy5yZXN1bHQuY29kZSArCiAgICAgICAgICAgICAgICAiJnN0YXRlPSIgKwogICAgICAgICAgICAgICAgcmVzLnJlc3VsdC5zdGF0ZTsKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLmdldENhcHRjaGFJbWcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmp1ZGdlVXJsKCk7CiAgICAvLyDliKTmlq3mmK/lkKborqTor4Hov4cKICAgIGxldCB1c2VybmFtZSA9IENvb2tpZXMuZ2V0KCJvYXV0aFVzZXJuYW1lIik7CiAgICBpZiAodXNlcm5hbWUpIHsKICAgICAgdGhpcy5hdXRoTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuZm9ybS51c2VybmFtZSA9IHVzZXJuYW1lOwogICAgICBhdXRob3JpemVkKHRoaXMuZm9ybSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgbGV0IHVybCA9CiAgICAgICAgICAgIHJlcy5yZXN1bHQucmVkaXJlY3RfdXJpICsKICAgICAgICAgICAgIj9jb2RlPSIgKwogICAgICAgICAgICByZXMucmVzdWx0LmNvZGUgKwogICAgICAgICAgICAiJnN0YXRlPSIgKwogICAgICAgICAgICByZXMucmVzdWx0LnN0YXRlOwogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXV0aExvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgdGhpcy5nZXRDYXB0Y2hhSW1nKCk7CiAgfQp9Owo="},{"version":3,"sources":["authorize.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"authorize.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"authorize\">\n    <Row\n      type=\"flex\"\n      justify=\"center\"\n      align=\"middle\"\n      @keydown.enter.native=\"submit\"\n      style=\"height:100%\"\n    >\n      <Col class=\"layout\">\n        <div>\n          <Header />\n          <Row v-if=\"!error&&!authLoading\">\n            <Tabs value=\"1\">\n              <TabPane label=\"XBoot统一认证平台\" name=\"1\" icon=\"md-people\">\n                <Form ref=\"loginForm\" :model=\"form\" :rules=\"rules\" class=\"form\">\n                  <FormItem prop=\"username\">\n                    <Input\n                      v-model=\"form.username\"\n                      prefix=\"ios-contact\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入用户名\"\n                      autocomplete=\"off\"\n                    />\n                  </FormItem>\n                  <FormItem prop=\"password\">\n                    <Input\n                      type=\"password\"\n                      v-model=\"form.password\"\n                      prefix=\"ios-lock\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入密码\"\n                      autocomplete=\"off\"\n                    />\n                  </FormItem>\n                  <FormItem prop=\"code\">\n                    <Row\n                      type=\"flex\"\n                      justify=\"space-between\"\n                      style=\"align-items: center;overflow: hidden;\"\n                    >\n                      <Input\n                        v-model=\"form.code\"\n                        size=\"large\"\n                        clearable\n                        placeholder=\"请输入图片验证码\"\n                        :maxlength=\"10\"\n                        style=\"width: 67%;\"\n                      />\n                      <div class=\"code-image\" style=\"position:relative;font-size:12px\">\n                        <Spin v-if=\"loadingCaptcha\" fix></Spin>\n                        <img\n                          :src=\"captchaImg\"\n                          @click=\"getCaptchaImg\"\n                          alt=\"加载验证码失败\"\n                          style=\"width:110px;cursor:pointer;display:block\"\n                        />\n                      </div>\n                    </Row>\n                  </FormItem>\n                </Form>\n              </TabPane>\n            </Tabs>\n            <Row>\n              <Button type=\"primary\" size=\"large\" :loading=\"loading\" @click=\"submit\" long>\n                <span v-if=\"!loading\">授权并登录</span>\n                <span v-else>授权中...</span>\n              </Button>\n            </Row>\n            <Row type=\"flex\" justify=\"space-between\" class=\"other-thing\">\n              <router-link to=\"/reset\" class=\"back\">忘记密码</router-link>\n              <router-link to=\"/regist\">\n                <a class=\"back\">还没有账号？立即注册</a>\n              </router-link>\n            </Row>\n          </Row>\n          <div v-if=\"error\" style=\"margin-top: 15vh\">\n            <Alert type=\"error\" show-icon>\n              {{title}}\n              <span slot=\"desc\">{{msg}}</span>\n            </Alert>\n          </div>\n          <div v-if=\"authLoading\">\n            <RectLoading />\n          </div>\n        </div>\n        <Footer />\n      </Col>\n      <LangSwitch />\n    </Row>\n  </div>\n</template>\n\n<script>\nimport Cookies from \"js-cookie\";\nimport { initCaptcha, drawCodeImage } from \"@/api/index\";\nimport { authorize, authorized } from \"@/api/open\";\nimport Header from \"@/views/main-components/header\";\nimport Footer from \"@/views/main-components/footer\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport RectLoading from \"@/views/my-components/xboot/rect-loading\";\nexport default {\n  components: {\n    LangSwitch,\n    Header,\n    Footer,\n    RectLoading\n  },\n  data() {\n    return {\n      authLoading: false,\n      title: \"\",\n      msg: \"\",\n      error: false,\n      loadingCaptcha: true,\n      captchaImg: \"\",\n      loading: false,\n      form: {\n        username: \"\",\n        password: \"\",\n        code: \"\",\n        client_id: \"\",\n        redirect_uri: \"\",\n        state: \"\",\n        response_type: \"\",\n        captchaId: this.captchaId\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        code: [\n          {\n            required: true,\n            message: \"验证码不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    judgeUrl() {\n      let q = this.$route.query;\n      if (!q.client_id) {\n        this.title = \"参数client_id非法\";\n        this.msg = \"The parameter client_id is illegal.\";\n        this.error = true;\n        return;\n      }\n      if (!q.redirect_uri) {\n        this.title = \"参数redirect_uri非法\";\n        this.msg = \"The parameter redirect_uri is illegal.\";\n        this.error = true;\n        return;\n      }\n      if (!q.state) {\n        this.title = \"参数state非法\";\n        this.msg = \"The parameter state is illegal.\";\n        this.error = true;\n        return;\n      }\n      this.form.client_id = q.client_id;\n      this.form.redirect_uri = q.redirect_uri;\n      this.form.state = q.state;\n      this.form.responseType = q.responseType;\n    },\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.form.captchaId = res.result;\n          this.captchaImg = drawCodeImage + res.result;\n        }\n      });\n    },\n    submit() {\n      this.$refs.loginForm.validate(valid => {\n        if (valid) {\n          this.loading = true;\n          authorize(this.form).then(res => {\n            if (res.success) {\n              // 存储认证信息 避免下次认证\n              Cookies.set(\"oauthUsername\", this.form.username, {\n                expires: 30\n              });\n              let url =\n                res.result.redirect_uri +\n                \"?code=\" +\n                res.result.code +\n                \"&state=\" +\n                res.result.state;\n              window.location.href = url;\n            } else {\n              this.loading = false;\n              this.getCaptchaImg();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    this.judgeUrl();\n    // 判断是否认证过\n    let username = Cookies.get(\"oauthUsername\");\n    if (username) {\n      this.authLoading = true;\n      this.form.username = username;\n      authorized(this.form).then(res => {\n        if (res.success) {\n          let url =\n            res.result.redirect_uri +\n            \"?code=\" +\n            res.result.code +\n            \"&state=\" +\n            res.result.state;\n          window.location.href = url;\n        } else {\n          this.authLoading = false;\n        }\n      });\n    }\n    this.getCaptchaImg();\n  }\n};\n</script>\n\n<style lang=\"less\">\n@import \"./authorize.less\";\n</style>\n"]}]}