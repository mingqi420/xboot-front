{"remainingRequest":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\sys\\department-manage\\departmentManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\src\\views\\sys\\department-manage\\departmentManage.vue","mtime":1600218271000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\dove\\project\\xboot\\xboot-front-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4uLy4uLy4uL3N0eWxlcy90cmVlLWNvbW1vbi5sZXNzIjsKQGltcG9ydCAiLi9kZXBhcnRtZW50TWFuYWdlLmxlc3MiOwo="},{"version":3,"sources":["departmentManage.vue"],"names":[],"mappings":";AACA;AACA","file":"departmentManage.vue","sourceRoot":"src/views/sys/department-manage","sourcesContent":["<style lang=\"less\">\n@import \"../../../styles/tree-common.less\";\n@import \"./departmentManage.less\";\n</style>\n<template>\n  <div class=\"search\">\n    <Card>\n      <Row class=\"operation\">\n        <Button @click=\"add\" type=\"primary\" icon=\"md-add\" v-show=\"showType=='tree'\">添加子部门</Button>\n        <Button @click=\"addRoot\" icon=\"md-add\">添加一级部门</Button>\n        <Button @click=\"delAll\" icon=\"md-trash\">批量删除</Button>\n        <Button @click=\"getParentList\" icon=\"md-refresh\">刷新</Button>\n        <Input\n          v-model=\"searchKey\"\n          suffix=\"ios-search\"\n          @on-change=\"search\"\n          placeholder=\"输入部门名搜索\"\n          clearable\n          style=\"width: 250px\"\n          v-show=\"showType=='list'\"\n        />\n        <i-switch v-model=\"strict\" size=\"large\" v-show=\"showType=='tree'\" style=\"margin-left:5px\">\n          <span slot=\"open\">级联</span>\n          <span slot=\"close\">单选</span>\n        </i-switch>\n        <div style=\"float: right\">\n          <RadioGroup v-model=\"showType\" type=\"button\">\n            <Radio title=\"树结构\" label=\"tree\">\n              <Icon type=\"md-list\"></Icon>\n            </Radio>\n            <Radio title=\"列表\" label=\"list\">\n              <Icon type=\"ios-apps\"></Icon>\n            </Radio>\n          </RadioGroup>\n        </div>\n      </Row>\n      <Row type=\"flex\" justify=\"start\" v-show=\"showType=='tree'\">\n        <Col :md=\"8\" :lg=\"8\" :xl=\"6\">\n          <Alert show-icon>\n            当前选择编辑：\n            <span class=\"select-title\">{{editTitle}}</span>\n            <a class=\"select-clear\" v-if=\"form.id\" @click=\"cancelEdit\">取消选择</a>\n          </Alert>\n          <Input\n            v-model=\"searchKey\"\n            suffix=\"ios-search\"\n            @on-change=\"search\"\n            placeholder=\"输入部门名搜索\"\n            clearable\n          />\n          <div class=\"tree-bar\" :style=\"{maxHeight: maxHeight}\">\n            <Tree\n              ref=\"tree\"\n              :data=\"data\"\n              :load-data=\"loadData\"\n              show-checkbox\n              @on-check-change=\"changeSelect\"\n              @on-select-change=\"selectTree\"\n              :check-strictly=\"!strict\"\n            ></Tree>\n            <Spin size=\"large\" fix v-if=\"loading\"></Spin>\n          </div>\n        </Col>\n        <Col :md=\"15\" :lg=\"13\" :xl=\"9\" style=\"margin-left:10px;\">\n          <Form ref=\"form\" :model=\"form\" :label-width=\"100\" :rules=\"formValidate\">\n            <FormItem label=\"上级部门\" prop=\"parentTitle\">\n              <div style=\"display:flex;\">\n                <Input v-model=\"form.parentTitle\" readonly style=\"margin-right:10px;\" />\n                <Poptip transfer trigger=\"click\" placement=\"right-start\" title=\"选择上级部门\" width=\"250\">\n                  <Button icon=\"md-list\">选择部门</Button>\n                  <div slot=\"content\" style=\"position:relative;min-height:5vh\">\n                    <Tree :data=\"dataEdit\" :load-data=\"loadData\" @on-select-change=\"selectTreeEdit\"></Tree>\n                    <Spin size=\"large\" fix v-if=\"loadingEdit\"></Spin>\n                  </div>\n                </Poptip>\n              </div>\n            </FormItem>\n            <FormItem label=\"部门名称\" prop=\"title\">\n              <Input v-model=\"form.title\" />\n            </FormItem>\n            <FormItem label=\"部门负责人\" prop=\"mainHeader\">\n              <Select\n                :loading=\"userLoading\"\n                not-found-text=\"该部门暂无用户数据\"\n                v-model=\"form.mainHeader\"\n                multiple\n                filterable\n                placeholder=\"请选择或输入搜索用户\"\n              >\n                <Option\n                  v-for=\"item in users\"\n                  :value=\"item.id\"\n                  :key=\"item.id\"\n                  :label=\"item.nickname\"\n                >\n                  <span style=\"margin-right:10px;\">{{ item.nickname }}</span>\n                  <span style=\"color:#ccc;\">{{ item.username }}</span>\n                </Option>\n              </Select>\n            </FormItem>\n            <FormItem label=\"副负责人\" prop=\"viceHeader\">\n              <Select\n                :loading=\"userLoading\"\n                not-found-text=\"该部门暂无用户数据\"\n                v-model=\"form.viceHeader\"\n                multiple\n                filterable\n                placeholder=\"请选择或输入搜索用户\"\n              >\n                <Option\n                  v-for=\"item in users\"\n                  :value=\"item.id\"\n                  :key=\"item.id\"\n                  :label=\"item.nickname\"\n                >\n                  <span style=\"margin-right:10px;\">{{ item.nickname }}</span>\n                  <span style=\"color:#ccc;\">{{ item.username }}</span>\n                </Option>\n              </Select>\n            </FormItem>\n            <FormItem label=\"排序值\" prop=\"sortOrder\">\n              <Tooltip trigger=\"hover\" placement=\"right\" content=\"值越小越靠前，支持小数\">\n                <InputNumber :max=\"1000\" :min=\"0\" v-model=\"form.sortOrder\"></InputNumber>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"是否启用\" prop=\"status\">\n              <i-switch size=\"large\" v-model=\"form.status\" :true-value=\"0\" :false-value=\"-1\">\n                <span slot=\"open\">启用</span>\n                <span slot=\"close\">禁用</span>\n              </i-switch>\n            </FormItem>\n            <Form-item class=\"br\">\n              <Button\n                @click=\"submitEdit\"\n                :loading=\"submitLoading\"\n                type=\"primary\"\n                icon=\"ios-create-outline\"\n              >修改并保存</Button>\n              <Button @click=\"handleReset\">重置</Button>\n            </Form-item>\n          </Form>\n        </Col>\n      </Row>\n      <Alert show-icon v-show=\"showType=='list'\">\n        已选择\n        <span class=\"select-count\">{{selectCount}}</span> 项\n        <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\n      </Alert>\n      <Table\n        row-key=\"title\"\n        :load-data=\"loadData\"\n        :columns=\"columns\"\n        :data=\"data\"\n        :loading=\"loading\"\n        border\n        ref=\"table\"\n        @on-selection-change=\"showSelect\"\n        v-if=\"showType=='list'\"\n      ></Table>\n    </Card>\n\n    <Modal :title=\"modalTitle\" v-model=\"modalVisible\" :mask-closable=\"false\" :width=\"500\">\n      <Form ref=\"formAdd\" :model=\"formAdd\" :label-width=\"85\" :rules=\"formValidate\">\n        <div v-if=\"showParent\">\n          <FormItem label=\"上级部门：\">{{form.title}}</FormItem>\n        </div>\n        <FormItem label=\"部门名称\" prop=\"title\">\n          <Input v-model=\"formAdd.title\" />\n        </FormItem>\n        <FormItem label=\"排序值\" prop=\"sortOrder\">\n          <Tooltip trigger=\"hover\" placement=\"right\" content=\"值越小越靠前，支持小数\">\n            <InputNumber :max=\"1000\" :min=\"0\" v-model=\"formAdd.sortOrder\"></InputNumber>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"是否启用\" prop=\"status\">\n          <i-switch size=\"large\" v-model=\"formAdd.status\" :true-value=\"0\" :false-value=\"-1\">\n            <span slot=\"open\">启用</span>\n            <span slot=\"close\">禁用</span>\n          </i-switch>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancelAdd\">取消</Button>\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitAdd\">提交</Button>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport {\n  initDepartment,\n  loadDepartment,\n  addDepartment,\n  editDepartment,\n  deleteDepartment,\n  searchDepartment,\n  getUserByDepartmentId\n} from \"@/api/index\";\nexport default {\n  name: \"department-manage\",\n  data() {\n    return {\n      showType: \"tree\",\n      loading: true,\n      maxHeight: \"500px\",\n      strict: true,\n      userLoading: false,\n      loadingEdit: true,\n      modalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      modalTitle: \"\",\n      editTitle: \"\",\n      searchKey: \"\",\n      form: {\n        id: \"\",\n        title: \"\",\n        parentId: \"\",\n        parentTitle: \"\",\n        sortOrder: 0,\n        status: 0\n      },\n      formAdd: {},\n      formValidate: {\n        title: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }],\n        sortOrder: [\n          {\n            required: true,\n            type: \"number\",\n            message: \"排序值不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      },\n      submitLoading: false,\n      data: [],\n      dataEdit: [],\n      users: [],\n      columns: [\n        {\n          type: \"selection\",\n          width: 60,\n          align: \"center\"\n        },\n        {\n          type: \"index\",\n          width: 60,\n          align: \"center\"\n        },\n        {\n          title: \"部门名称\",\n          key: \"title\",\n          minWidth: 120,\n          sortable: true,\n          tree: true\n        },\n        {\n          title: \"排序\",\n          key: \"sortOrder\",\n          width: 150,\n          sortable: true,\n          align: \"center\",\n          sortType: \"asc\"\n        },\n        {\n          title: \"创建时间\",\n          key: \"createTime\",\n          sortable: true,\n          width: 200\n        },\n        {\n          title: \"操作\",\n          key: \"action\",\n          width: 300,\n          align: \"center\",\n          render: (h, params) => {\n            return h(\"div\", [\n              h(\n                \"Button\",\n                {\n                  props: {\n                    type: \"primary\",\n                    size: \"small\",\n                    icon: \"md-add\"\n                  },\n                  style: {\n                    marginRight: \"5px\"\n                  },\n                  on: {\n                    click: () => {\n                      this.tableAdd(params.row);\n                    }\n                  }\n                },\n                \" 添加子部门\"\n              ),\n              h(\n                \"Button\",\n                {\n                  props: {\n                    type: \"error\",\n                    size: \"small\"\n                  },\n                  on: {\n                    click: () => {\n                      this.remove(params.row);\n                    }\n                  }\n                },\n                \"删除\"\n              )\n            ]);\n          }\n        }\n      ]\n    };\n  },\n  methods: {\n    init() {\n      this.getParentList();\n      this.getParentListEdit();\n    },\n    getParentList() {\n      this.loading = true;\n      initDepartment().then(res => {\n        this.loading = false;\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n              e._loading = false;\n            }\n          });\n          this.data = res.result;\n        }\n      });\n    },\n    getParentListEdit() {\n      this.loadingEdit = true;\n      initDepartment().then(res => {\n        this.loadingEdit = false;\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n          });\n          // 头部加入一级\n          let first = {\n            id: \"0\",\n            title: \"一级部门\"\n          };\n          res.result.unshift(first);\n          this.dataEdit = res.result;\n        }\n      });\n    },\n    loadData(item, callback) {\n      loadDepartment(item.id).then(res => {\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n              e._loading = false;\n            }\n          });\n          callback(res.result);\n        }\n      });\n    },\n    search() {\n      if (this.searchKey) {\n        this.loading = true;\n        searchDepartment({ title: this.searchKey }).then(res => {\n          this.loading = false;\n          if (res.success) {\n            this.data = res.result;\n          }\n        });\n      } else {\n        this.getParentList();\n      }\n    },\n    selectTree(v) {\n      if (v.length > 0) {\n        // 转换null为\"\"\n        for (let attr in v[0]) {\n          if (v[0][attr] == null) {\n            v[0][attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v[0]);\n        let data = JSON.parse(str);\n        this.editTitle = data.title;\n        // 加载部门用户数据\n        this.userLoading = true;\n        getUserByDepartmentId(data.id).then(res => {\n          this.userLoading = false;\n          if (res.success) {\n            this.users = res.result;\n            // 回显\n            this.form = data;\n          }\n        });\n      } else {\n        this.cancelEdit();\n      }\n    },\n    cancelEdit() {\n      let data = this.$refs.tree.getSelectedNodes()[0];\n      if (data) {\n        data.selected = false;\n      }\n      this.$refs.form.resetFields();\n      delete this.form.id;\n      this.editTitle = \"\";\n    },\n    selectTreeEdit(v) {\n      if (v.length > 0) {\n        // 转换null为\"\"\n        for (let attr in v[0]) {\n          if (v[0][attr] == null) {\n            v[0][attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v[0]);\n        let data = JSON.parse(str);\n        this.form.parentId = data.id;\n        this.form.parentTitle = data.title;\n      }\n    },\n    cancelAdd() {\n      this.modalVisible = false;\n    },\n    handleReset() {\n      this.$refs.form.resetFields();\n      this.form.status = 0;\n    },\n    showSelect(e) {\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    },\n    submitEdit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          if (!this.form.id) {\n            this.$Message.warning(\"请先点击选择要修改的部门\");\n            return;\n          }\n          this.submitLoading = true;\n          editDepartment(this.form).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"编辑成功\");\n              this.init();\n              this.modalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    submitAdd() {\n      this.$refs.formAdd.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          addDepartment(this.formAdd).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"添加成功\");\n              this.init();\n              this.modalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    tableAdd(v) {\n      this.form = v;\n      this.add();\n    },\n    add() {\n      if (this.form.id == \"\" || this.form.id == null) {\n        this.$Message.warning(\"请先点击选择一个部门\");\n        return;\n      }\n      this.modalTitle = \"添加子部门\";\n      this.showParent = true;\n      this.formAdd = {\n        parentId: this.form.id,\n        sortOrder: 0,\n        status: 0\n      };\n      this.modalVisible = true;\n    },\n    addRoot() {\n      this.modalTitle = \"添加一级部门\";\n      this.showParent = false;\n      this.formAdd = {\n        parentId: 0,\n        sortOrder: 0,\n        status: 0\n      };\n      this.modalVisible = true;\n    },\n    changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    remove(v) {\n      this.selectCount = 1;\n      this.selectList.push(v);\n      this.delAll();\n    },\n    delAll() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未勾选要删除的数据\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content:\n          \"您确认要删除所选的 \" + this.selectCount + \" 条数据及其下级所有数据?\",\n        loading: true,\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function(e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          deleteDepartment({ids: ids}).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"删除成功\");\n              this.selectList = [];\n              this.selectCount = 0;\n              this.cancelEdit();\n              this.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    // 计算高度\n    let height = document.documentElement.clientHeight;\n    this.maxHeight = Number(height - 287) + \"px\";\n    this.init();\n  }\n};\n</script>"]}]}